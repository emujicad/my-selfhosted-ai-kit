%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#1a1a2e', 'primaryTextColor':'#eaeaea', 'primaryBorderColor':'#4a4a6a', 'lineColor':'#6c63ff', 'fontSize':'14px', 'fontFamily':'Inter, Segoe UI, sans-serif'}}}%%
graph TB
    subgraph TITLE [" "]
        direction LR
        T["ğŸ¯ MY SELF-HOSTED AI KIT - Profile Architecture"]
    end
    
    subgraph AI ["ğŸ¤– AI Profiles"]
        direction TB
        CPU["<b>cpu</b><br/>â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ–¥ï¸ Ollama CPU"]
        NVIDIA["<b>gpu-nvidia</b><br/>â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ® Ollama GPU<br/>ğŸ“¦ Model Puller<br/>ğŸ“Š NVIDIA Exporter"]
        AMD["<b>gpu-amd</b><br/>â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ® Ollama AMD"]
    end
    
    subgraph APPS ["ğŸ“¦ Application Profiles"]
        direction TB
        CHATAI["<b>chat-ai</b><br/>â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ’¬ Open WebUI"]
        AUTO["<b>automation</b><br/>â”â”â”â”â”â”â”â”â”â”â”<br/>âš™ï¸ n8n<br/>ğŸ”„ Watchtower<br/>ğŸ“‚ Sync"]
        CICD["<b>ci-cd</b><br/>â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ”§ Jenkins<br/>Port 8081â†’8082"]
        GENAI["<b>gen-ai</b><br/>â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ” Keycloak<br/>ğŸ”§ Jenkins"]
    end
    
    subgraph INFRA ["ğŸ—ï¸ Infrastructure Profiles"]
        direction TB
        SEC["<b>security</b><br/>â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ” Keycloak<br/>ğŸ›¡ï¸ ModSecurity<br/>âš™ï¸ keycloak-init"]
        INFRAP["<b>infrastructure</b><br/>â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ’¾ Redis :6379<br/>ğŸŒ HAProxy :80"]
        MON["<b>monitoring</b><br/>â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ“Š Prometheus :9090<br/>ğŸ“ˆ Grafana :3001<br/>ğŸ”” AlertManager :9093<br/>ğŸ’¾ Backup Runner<br/>ğŸ“¡ 7 Exporters"]
    end
    
    subgraph DEV ["ğŸ› ï¸ Development Profiles"]
        direction TB
        DEVP["<b>dev</b><br/>â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ’» Dev Tools<br/>(curl, jq, etc.)"]
        TEST["<b>testing</b><br/>â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ§ª Test Runner"]
        DEBUG["<b>debug</b><br/>â”â”â”â”â”â”â”â”â”â”â”<br/>ğŸ› Debug Tools"]
    end
    
    subgraph BASE ["ğŸ“š Base Services (Always Available)"]
        direction LR
        PG["ğŸ—„ï¸ PostgreSQL :5432"]
        QDRANT["ğŸ”® Qdrant :6333"]
        PGVEC["ğŸ“ pgvector :5433"]
    end
    
    %% Auto-include dependencies (from stack-manager.sh)
    CHATAI ==>|"auto-includes"| SEC
    CHATAI ==>|"auto-includes"| INFRAP
    CHATAI ==>|"auto-includes"| NVIDIA
    
    AUTO ==>|"auto-includes"| SEC
    
    MON ==>|"auto-includes"| SEC
    MON ==>|"auto-includes"| INFRAP
    
    CICD ==>|"auto-includes"| SEC
    
    %% Optional relationships
    CPU -.->|"alternative"| CHATAI
    AMD -.->|"alternative"| CHATAI
    
    %% Monitoring connections
    NVIDIA -.->|"metrics"| MON
    AUTO -.->|"metrics"| MON
    CHATAI -.->|"metrics"| MON
    
    %% Styling
    classDef title fill:#1a1a2e,stroke:#6c63ff,stroke-width:0px,color:#fff,font-size:18px,font-weight:bold
    classDef ai fill:#0d47a1,stroke:#1976d2,stroke-width:2px,color:#fff
    classDef apps fill:#4a148c,stroke:#7b1fa2,stroke-width:2px,color:#fff
    classDef infra fill:#1b5e20,stroke:#388e3c,stroke-width:2px,color:#fff
    classDef dev fill:#e65100,stroke:#f57c00,stroke-width:2px,color:#fff
    classDef base fill:#37474f,stroke:#607d8b,stroke-width:2px,color:#fff
    
    class T title
    class CPU,NVIDIA,AMD ai
    class CHATAI,AUTO,CICD,GENAI apps
    class SEC,INFRAP,MON infra
    class DEVP,TEST,DEBUG dev
    class PG,QDRANT,PGVEC base
