%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#e8f5e9', 'primaryTextColor':'#1b5e20', 'primaryBorderColor':'#388e3c', 'lineColor':'#424242', 'fontSize':'16px'}}}%%
graph TB
    subgraph "ğŸ¤– Perfiles de IA"
        CPU["cpu<br/>Ollama (CPU)"]
        NVIDIA["gpu-nvidia<br/>Ollama (GPU NVIDIA)"]
        AMD["gpu-amd<br/>Ollama (GPU AMD)"]
    end
    
    subgraph "ğŸ”§ Servicios Base (sin perfil especÃ­fico)"
        QDRANT["qdrant<br/>Base de datos vectorial"]
        PGVECTOR["pgvector<br/>ExtensiÃ³n PostgreSQL"]
        POSTGRES["postgres<br/>Base de datos relacional"]
    end
    
    subgraph "ğŸ“¦ Perfiles de Aplicaciones"
        CHATAI["chat-ai<br/>ğŸ’¬ Open WebUI"]
        AUTO["automation<br/>âš™ï¸ n8n, Watchtower, Sync"]
        CICD["ci-cd<br/>ğŸ”§ Jenkins"]
    end
    
    subgraph "ğŸ—ï¸ Perfiles de Infraestructura"
        SEC["security<br/>ğŸ” Keycloak + ModSecurity"]
        INFRA["infrastructure<br/>ğŸ’¾ Redis + HAProxy"]
        MON["monitoring<br/>ğŸ“Š Prometheus + Grafana"]
    end
    
    subgraph "ğŸ› ï¸ Perfiles de Desarrollo"
        DEV["dev<br/>ğŸ’» Herramientas desarrollo"]
        TEST["testing<br/>ğŸ§ª Test Runner"]
        DEBUG["debug<br/>ğŸ› Debug Tools"]
    end
    
    %% Dependencias de Perfiles de IA
    CPU -.->|Opcional para| CHATAI
    CPU -.->|Opcional para| AUTO
    NVIDIA ==>|Requerido por| CHATAI
    NVIDIA -.->|Opcional para| AUTO
    AMD -.->|Alternativa GPU| CHATAI
    
    %% Dependencias AutomÃ¡ticas (stack-manager.sh)
    CHATAI ==>|Auto-incluye| SEC
    CHATAI ==>|Auto-incluye| INFRA
    CHATAI ==>|Auto-incluye| NVIDIA
    
    AUTO ==>|Auto-incluye| SEC
    
    MON ==>|Auto-incluye| SEC
    
    CICD ==>|Auto-incluye| SEC
    
    %% Relaciones de uso
    CHATAI -.->|Monitorea| MON
    AUTO -.->|Monitorea| MON
    POSTGRES -.->|Monitorea| MON
    QDRANT -.->|Monitorea| MON
    
    AUTO -.->|Puede integrar| CICD
    AUTO -.->|Usa en dev| TEST
    AUTO -.->|Usa en dev| DEBUG
    AUTO -.->|Usa en dev| DEV
    
    %% Servicios base usan PostgreSQL
    QDRANT -.->|Usa| POSTGRES
    PGVECTOR -.->|ExtensiÃ³n de| POSTGRES
    
    %% Estilos profesionales
    classDef ia fill:#e3f2fd,stroke:#1976d2,stroke-width:3px,color:#1a237e
    classDef base fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px,color:#4a148c
    classDef apps fill:#fff9c4,stroke:#f57f17,stroke-width:3px,color:#e65100
    classDef infra fill:#e8f5e9,stroke:#388e3c,stroke-width:3px,color:#1b5e20
    classDef dev fill:#fce4ec,stroke:#d81b60,stroke-width:3px,color:#880e4f
    
    class CPU,NVIDIA,AMD ia
    class QDRANT,PGVECTOR,POSTGRES base
    class CHATAI,AUTO,CICD apps
    class SEC,INFRA,MON infra
    class DEV,TEST,DEBUG dev
    
    %% Leyenda
    Note1["ğŸ’¡ Leyenda:<br/>â•â•â–º Auto-incluido (stack-manager.sh)<br/>â”€ â”€â–º RelaciÃ³n opcional/uso"]
    
    classDef legend fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#e65100
    class Note1 legend