%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#1a1a2e', 'primaryTextColor':'#eaeaea', 'primaryBorderColor':'#4a4a6a', 'lineColor':'#6c63ff', 'fontSize':'13px', 'fontFamily':'Inter, Segoe UI, sans-serif'}}}%%
graph TB
    subgraph TITLE ["ğŸ®ğŸ“Š GPU + MONITORING - AI with Full Observability"]
        direction LR
        CMD["docker compose --profile gpu-nvidia --profile monitoring up -d"]
    end
    
    subgraph GPUNVIDIA ["ğŸ® gpu-nvidia"]
        OLLAMA["ğŸ§  Ollama GPU<br/>:11434<br/>â”â”â”â”â”â”â”â”â”â”<br/>â€¢ CUDA Acceleration<br/>â€¢ Multi-model support<br/>â€¢ 16GB+ VRAM"]
        PULLER["ğŸ“¦ Model Puller<br/>â”â”â”â”â”â”â”â”â”â”<br/>â€¢ llama3.2<br/>â€¢ llama3.3<br/>â€¢ deepseek-r1:14b<br/>â€¢ all-minilm<br/>â€¢ nomic-embed-text"]
        NVEXP["ğŸ“Š nvidia-exporter<br/>:9400"]
    end
    
    subgraph MONITORING ["ğŸ“Š monitoring"]
        PROM["ğŸ“Š Prometheus<br/>:9090<br/>â”â”â”â”â”â”â”â”â”â”<br/>Scrape interval: 15s"]
        GRAF["ğŸ“ˆ Grafana<br/>:3001<br/>â”â”â”â”â”â”â”â”â”â”<br/>â€¢ Ollama Dashboard<br/>â€¢ System Overview<br/>â€¢ GPU Metrics"]
        ALERT["ğŸ”” AlertManager<br/>:9093"]
        BACKUP["ğŸ’¾ Backup Runner"]
    end
    
    subgraph EXPORTERS ["ğŸ“¡ Exporters"]
        direction LR
        OLLEXP["ollama-exp<br/>:9888"]
        NODEEXP["node-exp<br/>:9100"]
        CADV["cAdvisor<br/>:8082"]
        PGEXP["postgres-exp<br/>:9187"]
    end
    
    subgraph BASE ["ğŸ—„ï¸ Base"]
        PG["ğŸ—„ï¸ PostgreSQL"]
        QDRANT["ğŸ”® Qdrant"]
    end
    
    %% Model loading
    PULLER -->|"Downloads to"| OLLAMA
    
    %% Metrics flow
    NVEXP -->|"GPU Metrics"| PROM
    OLLEXP -->|"Model Metrics"| PROM
    NODEEXP -->|"Host Metrics"| PROM
    CADV -->|"Container Metrics"| PROM
    PGEXP -->|"DB Metrics"| PROM
    
    OLLAMA -.-> NVEXP
    OLLAMA -.-> OLLEXP
    
    %% Dashboard
    GRAF -->|"Query"| PROM
    PROM -->|"Alerts"| ALERT
    
    %% Note
    NOTE["ğŸ“ˆ Key Metrics:<br/>â”â”â”â”â”â”â”â”â”â”<br/>â€¢ GPU utilization<br/>â€¢ VRAM usage<br/>â€¢ Model load time<br/>â€¢ Inference latency<br/>â€¢ Queue depth"]
    
    %% Styling
    classDef title fill:#1a1a2e,stroke:#6c63ff,stroke-width:0px,color:#fff
    classDef gpu fill:#0d47a1,stroke:#1976d2,stroke-width:2px,color:#fff
    classDef monitoring fill:#1b5e20,stroke:#388e3c,stroke-width:2px,color:#fff
    classDef exporters fill:#e65100,stroke:#f57c00,stroke-width:2px,color:#fff
    classDef base fill:#37474f,stroke:#607d8b,stroke-width:2px,color:#fff
    classDef note fill:#fff3e0,stroke:#f57c00,stroke-width:2px,color:#e65100
    
    class CMD title
    class OLLAMA,PULLER,NVEXP gpu
    class PROM,GRAF,ALERT,BACKUP monitoring
    class OLLEXP,NODEEXP,CADV,PGEXP exporters
    class PG,QDRANT base
    class NOTE note
