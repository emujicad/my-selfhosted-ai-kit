%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#1a1a2e', 'primaryTextColor':'#eaeaea', 'primaryBorderColor':'#4a4a6a', 'lineColor':'#6c63ff', 'fontSize':'13px', 'fontFamily':'Inter, Segoe UI, sans-serif'}}}%%
graph TB
    subgraph TITLE ["ğŸš€ FULL STACK - All Profiles Active"]
        direction LR
        CMD["./stack-manager.sh start full"]
    end
    
    subgraph AI ["ğŸ¤– gpu-nvidia"]
        OLLAMA["ğŸ§  Ollama GPU<br/>:11434"]
        PULLER["ğŸ“¦ Model Puller"]
        NVEXP["ğŸ“Š nvidia-exporter"]
    end
    
    subgraph CHATAI ["ğŸ’¬ chat-ai"]
        WEBUI["ğŸ’¬ Open WebUI<br/>:3000"]
    end
    
    subgraph AUTOMATION ["âš™ï¸ automation"]
        N8N["âš™ï¸ n8n<br/>:5678"]
        WATCH["ğŸ”„ Watchtower"]
        SYNC["ğŸ“‚ Sync"]
    end
    
    subgraph CICD ["ğŸ”§ ci-cd"]
        JENKINS["ğŸ”§ Jenkins<br/>:8081"]
    end
    
    subgraph SECURITY ["ğŸ” security"]
        KC["ğŸ” Keycloak<br/>:8080"]
        MODSEC["ğŸ›¡ï¸ ModSecurity"]
        KCINIT["âš™ï¸ keycloak-init"]
    end
    
    subgraph INFRASTRUCTURE ["ğŸ—ï¸ infrastructure"]
        REDIS["ğŸ’¾ Redis<br/>:6379"]
        HAPROXY["ğŸ”€ HAProxy<br/>:80"]
    end
    
    subgraph MONITORING ["ğŸ“Š monitoring"]
        PROM["ğŸ“Š Prometheus<br/>:9090"]
        GRAF["ğŸ“ˆ Grafana<br/>:3001"]
        ALERT["ğŸ”” AlertManager<br/>:9093"]
        BACKUP["ğŸ’¾ Backup"]
        NODEEXP["ğŸ“¡ node-exporter"]
        CADV["ğŸ“¡ cAdvisor"]
        PGEXP["ğŸ“¡ postgres-exp"]
        REDEXP["ğŸ“¡ redis-exp"]
        OLLEXP["ğŸ“¡ ollama-exp"]
        N8NEXP["ğŸ“¡ n8n-exp"]
        OWEXP["ğŸ“¡ webui-exp"]
    end
    
    subgraph TESTING ["ğŸ§ª testing"]
        TESTRUN["ğŸ§ª Test Runner"]
    end
    
    subgraph DEBUG ["ğŸ› debug"]
        DBGTOOLS["ğŸ› Debug Tools"]
    end
    
    subgraph BASE ["ğŸ—„ï¸ Base Services"]
        PG["ğŸ—„ï¸ PostgreSQL"]
        QDRANT["ğŸ”® Qdrant"]
        PGVEC["ğŸ“ pgvector"]
    end
    
    %% Connections
    WEBUI --> OLLAMA
    WEBUI --> KC
    N8N --> OLLAMA
    N8N --> KC
    JENKINS --> KC
    GRAF --> KC
    GRAF --> PROM
    
    WEBUI --> PG
    N8N --> PG
    KC --> PG
    WEBUI --> QDRANT
    WEBUI --> REDIS
    
    HAPROXY --> WEBUI
    HAPROXY --> GRAF
    HAPROXY --> PROM
    
    %% Styling
    classDef title fill:#1a1a2e,stroke:#6c63ff,stroke-width:0px,color:#fff
    classDef ai fill:#0d47a1,stroke:#1976d2,stroke-width:2px,color:#fff
    classDef chatai fill:#1565c0,stroke:#1e88e5,stroke-width:2px,color:#fff
    classDef automation fill:#4a148c,stroke:#7b1fa2,stroke-width:2px,color:#fff
    classDef cicd fill:#37474f,stroke:#607d8b,stroke-width:2px,color:#fff
    classDef security fill:#b71c1c,stroke:#d32f2f,stroke-width:2px,color:#fff
    classDef infra fill:#00695c,stroke:#00897b,stroke-width:2px,color:#fff
    classDef monitoring fill:#1b5e20,stroke:#388e3c,stroke-width:2px,color:#fff
    classDef testing fill:#f57f17,stroke:#fbc02d,stroke-width:2px,color:#000
    classDef debug fill:#e65100,stroke:#f57c00,stroke-width:2px,color:#fff
    classDef base fill:#455a64,stroke:#78909c,stroke-width:2px,color:#fff
    
    class CMD title
    class OLLAMA,PULLER,NVEXP ai
    class WEBUI chatai
    class N8N,WATCH,SYNC automation
    class JENKINS cicd
    class KC,MODSEC,KCINIT security
    class REDIS,HAPROXY infra
    class PROM,GRAF,ALERT,BACKUP,NODEEXP,CADV,PGEXP,REDEXP,OLLEXP,N8NEXP,OWEXP monitoring
    class TESTRUN testing
    class DBGTOOLS debug
    class PG,QDRANT,PGVEC base
