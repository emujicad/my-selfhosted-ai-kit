%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#1a1a2e', 'primaryTextColor':'#eaeaea', 'primaryBorderColor':'#4a4a6a', 'lineColor':'#6c63ff', 'fontSize':'13px', 'fontFamily':'Inter, Segoe UI, sans-serif'}}}%%
graph TB
    subgraph TITLE ["ğŸ­ PRODUCTION STACK - Recommended Setup"]
        direction LR
        CMD["./stack-manager.sh start production<br/><i>or: ./stack-manager.sh start</i>"]
    end
    
    subgraph GPUNVIDIA ["ğŸ® gpu-nvidia"]
        OLLAMA["ğŸ§  Ollama GPU<br/>:11434"]
        NVEXP["ğŸ“Š nvidia-exporter<br/>:9400"]
    end
    
    subgraph CHATAI ["ğŸ’¬ chat-ai"]
        WEBUI["ğŸ’¬ Open WebUI<br/>:3000"]
    end
    
    subgraph AUTOMATION ["âš™ï¸ automation"]
        N8N["âš™ï¸ n8n<br/>:5678"]
        WATCH["ğŸ”„ Watchtower<br/><i>Auto-updates</i>"]
        SYNC["ğŸ“‚ Sync<br/><i>Data sync</i>"]
    end
    
    subgraph SECURITY ["ğŸ” security"]
        KC["ğŸ” Keycloak<br/>:8080"]
        MODSEC["ğŸ›¡ï¸ ModSecurity"]
    end
    
    subgraph INFRASTRUCTURE ["ğŸ—ï¸ infrastructure"]
        REDIS["ğŸ’¾ Redis<br/>:6379"]
        HAPROXY["ğŸ”€ HAProxy<br/>:80/:443"]
    end
    
    subgraph MONITORING ["ğŸ“Š monitoring"]
        PROM["ğŸ“Š Prometheus<br/>:9090"]
        GRAF["ğŸ“ˆ Grafana<br/>:3001"]
        ALERT["ğŸ”” AlertManager<br/>:9093"]
        BACKUP["ğŸ’¾ Backup Runner"]
    end
    
    subgraph BASE ["ğŸ—„ï¸ Base"]
        PG["ğŸ—„ï¸ PostgreSQL"]
        QDRANT["ğŸ”® Qdrant"]
    end
    
    %% User Flow
    USER(["ğŸ‘¤ User"]) --> HAPROXY
    HAPROXY --> WEBUI
    HAPROXY --> GRAF
    
    %% AI Flow
    WEBUI --> OLLAMA
    WEBUI --> KC
    WEBUI --> REDIS
    WEBUI --> PG
    WEBUI --> QDRANT
    
    %% Automation Flow
    N8N --> OLLAMA
    N8N --> KC
    N8N --> PG
    
    %% Monitoring Flow
    GRAF --> PROM
    GRAF --> KC
    NVEXP -.-> PROM
    
    %% Note
    NOTE["ğŸ“‹ Profiles Included:<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>âœ“ gpu-nvidia<br/>âœ“ chat-ai<br/>âœ“ automation<br/>âœ“ security<br/>âœ“ infrastructure<br/>âœ“ monitoring"]
    
    %% Styling
    classDef title fill:#1a1a2e,stroke:#6c63ff,stroke-width:0px,color:#fff
    classDef ai fill:#0d47a1,stroke:#1976d2,stroke-width:2px,color:#fff
    classDef chatai fill:#1565c0,stroke:#1e88e5,stroke-width:2px,color:#fff
    classDef automation fill:#4a148c,stroke:#7b1fa2,stroke-width:2px,color:#fff
    classDef security fill:#b71c1c,stroke:#d32f2f,stroke-width:2px,color:#fff
    classDef infra fill:#00695c,stroke:#00897b,stroke-width:2px,color:#fff
    classDef monitoring fill:#1b5e20,stroke:#388e3c,stroke-width:2px,color:#fff
    classDef base fill:#37474f,stroke:#607d8b,stroke-width:2px,color:#fff
    classDef user fill:#0d47a1,stroke:#1976d2,stroke-width:2px,color:#fff
    classDef note fill:#e8f5e9,stroke:#388e3c,stroke-width:2px,color:#1b5e20
    
    class CMD title
    class OLLAMA,NVEXP ai
    class WEBUI chatai
    class N8N,WATCH,SYNC automation
    class KC,MODSEC security
    class REDIS,HAPROXY infra
    class PROM,GRAF,ALERT,BACKUP monitoring
    class PG,QDRANT base
    class USER user
    class NOTE note
